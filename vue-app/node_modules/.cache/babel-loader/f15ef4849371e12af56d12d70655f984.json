{"ast":null,"code":"import shop from '../../api/shop';\n\nconst state = () => ({\n  items: [],\n  checkoutStatus: null\n});\n\nconst getters = {\n  cartProducts(state, rootState) {\n    return state.items.map(({\n      id,\n      quantity\n    }) => {\n      const products = rootState.products.providerProducts.find(product => product.idProduct === id);\n      return {\n        id: products.idProduct,\n        name: products.nameProduct,\n        price: products.price,\n        quantity\n      };\n    });\n  },\n\n  cartTotalPrice(getters) {\n    return getters.cartProducts.reduce((product, total) => {\n      return total + product.price * product.quantity;\n    }, 0);\n  }\n\n};\nconst actions = {\n  async checkout({\n    commit,\n    state\n  }, products) {\n    const savedCartItems = [...state.items];\n    commit('setCheckoutStatus', null);\n    commit('setCartItems', {\n      items: []\n    });\n\n    try {\n      await shop.buyProducts(products);\n      commit('setCheckoutStatus', 'succesful');\n    } catch (e) {\n      console.error(e);\n      commit('setCheckoutStatus', 'failed');\n      commit('setCartItems', {\n        items: savedCartItems\n      });\n    }\n  },\n\n  addProductToCart({\n    state,\n    commit\n  }, product) {\n    commit('setCheckoutStatus', null);\n\n    if (product.inventory > 0) {\n      const cartItem = state.items.find(item => item.id === product.id);\n\n      if (!cartItem) {\n        commit('pushProductToCart', {\n          id: product.id\n        });\n      } else {\n        commit('incrementItemQuantity', {\n          id: product.id\n        });\n      }\n    }\n\n    commit('products/decrementProductInventory', {\n      id: product.id\n    }, {\n      root: true\n    });\n  }\n\n};\nconst mutations = {\n  pushProductToCart(state, {\n    id\n  }) {\n    state.items.push({\n      id,\n      quantity: 1\n    });\n  },\n\n  incrementItemQuantity(state, {\n    id\n  }) {\n    const cartItem = state.items.find(item => item.id === id);\n    cartItem.quantity++;\n  },\n\n  setCartItems(state, {\n    items\n  }) {\n    state.items = items;\n  },\n\n  setCheckoutStatus(state, status) {\n    state.checkoutStatus = status;\n  }\n\n};\nexport default {\n  namespaced: true,\n  state,\n  getters,\n  actions,\n  mutations\n};","map":{"version":3,"names":["shop","state","items","checkoutStatus","getters","cartProducts","rootState","map","id","quantity","products","providerProducts","find","product","idProduct","name","nameProduct","price","cartTotalPrice","reduce","total","actions","checkout","commit","savedCartItems","buyProducts","e","console","error","addProductToCart","inventory","cartItem","item","root","mutations","pushProductToCart","push","incrementItemQuantity","setCartItems","setCheckoutStatus","status","namespaced"],"sources":["/Users/charles/Documents/MicroFrontEnd/bistro/src/store/modules/cart.js"],"sourcesContent":["import shop from '../../api/shop'\n\nconst state = () => ({\n    items : [],\n    checkoutStatus: null\n})\n\nconst getters = {\n    cartProducts(state, rootState) {\n        return state.items.map(({id, quantity}) => {\n            const products = rootState.products.providerProducts.find(product => product.idProduct === id)\n            return {\n                id : products.idProduct,\n                name : products.nameProduct,\n                price : products.price,\n                quantity\n            }\n        })\n    },\n\n    cartTotalPrice (getters) {\n        return getters.cartProducts.reduce((product, total) => {\n            return total + product.price * product.quantity\n        }, 0)\n    }\n}\n\nconst actions = {\n    async checkout ({commit, state}, products) {\n        const savedCartItems = [...state.items]\n        commit('setCheckoutStatus', null)\n        commit('setCartItems', { items : []})\n        try {\n            await shop.buyProducts(products)\n            commit('setCheckoutStatus', 'succesful')\n        } catch(e) {\n            console.error(e)\n            commit('setCheckoutStatus', 'failed')\n            commit('setCartItems', {items : savedCartItems})\n        }\n    },\n\n    addProductToCart ({state, commit}, product) {\n        commit('setCheckoutStatus', null)\n        if (product.inventory > 0) {\n            const cartItem = state.items.find(item => item.id === product.id)\n            if (!cartItem) {\n                commit('pushProductToCart', {id : product.id})\n            } else {\n                commit('incrementItemQuantity', { id : product.id})\n            }\n        }\n        commit('products/decrementProductInventory', { id : product.id}, {root : true})\n    }\n}\n\nconst mutations = {\n    pushProductToCart (state, { id }) {\n        state.items.push({\n            id,\n            quantity: 1\n        })\n    },\n\n    incrementItemQuantity (state, { id }) {\n        const cartItem = state.items.find(item => item.id === id)\n        cartItem.quantity++\n    },\n\n    setCartItems (state, {items}) {\n        state.items = items\n    },\n\n    setCheckoutStatus (state, status) {\n        state.checkoutStatus = status\n    }\n}\n\nexport default {\n    namespaced: true,\n    state,\n    getters,\n    actions,\n    mutations\n  }"],"mappings":"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"},"metadata":{},"sourceType":"module"}